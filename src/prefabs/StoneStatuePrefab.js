// You can write more code here

/* START OF COMPILED CODE */

/* START-USER-IMPORTS */
/* END-USER-IMPORTS */

export default class StoneStatuePrefab extends Phaser.GameObjects.Container {

	constructor(scene, x, y) {
		super(scene, x ?? 1009, y ?? 1208);

		this.blendMode = Phaser.BlendModes.SKIP_CHECK;

		// rock_pillars_coming_from_darkness_bg_00
		const rock_pillars_coming_from_darkness_bg_00 = scene.add.image(14, 124, "rock pillars coming from darkness-bg_0", 0);
		this.add(rock_pillars_coming_from_darkness_bg_00);

		// statues_far_from_platforms_bg_40
		const statues_far_from_platforms_bg_40 = scene.add.image(16, -18, "statues-far from platforms-bg_4", 0);
		this.add(statues_far_from_platforms_bg_40);

		// crystals1_improved_refraction_80
		const crystals1_improved_refraction_80 = scene.add.image(-12, 71, "Crystals1-improved refraction_8", 0);
		this.add(crystals1_improved_refraction_80);

		// crystals1_improved_refraction_110
		const crystals1_improved_refraction_110 = scene.add.image(5, 86, "Crystals1-improved refraction_11", 0);
		this.add(crystals1_improved_refraction_110);

		// crystals1_improved_refraction_60
		const crystals1_improved_refraction_60 = scene.add.image(27, 87, "Crystals1-improved refraction_6", 0);
		this.add(crystals1_improved_refraction_60);

		// crystals1_improved_refraction
		const crystals1_improved_refraction = scene.add.image(42, 71, "Crystals1-improved refraction_8", 0);
		this.add(crystals1_improved_refraction);

		// crystals1_improved_refraction_1
		const crystals1_improved_refraction_1 = scene.add.image(-22, 97, "Crystals1-improved refraction_6", 0);
		this.add(crystals1_improved_refraction_1);

		// crystals1_improved_refraction_2
		const crystals1_improved_refraction_2 = scene.add.image(4, 111, "Crystals1-improved refraction_6", 0);
		this.add(crystals1_improved_refraction_2);

		// crystals1_improved_refraction_3
		const crystals1_improved_refraction_3 = scene.add.image(29, 117, "Crystals1-improved refraction_6", 0);
		this.add(crystals1_improved_refraction_3);

		// crystals1_improved_refraction_4
		const crystals1_improved_refraction_4 = scene.add.image(-24, 119, "Crystals1-improved refraction_6", 0);
		this.add(crystals1_improved_refraction_4);

		// crystals1_improved_refraction_5
		const crystals1_improved_refraction_5 = scene.add.image(-31, 148, "Crystals1-improved refraction_6", 0);
		this.add(crystals1_improved_refraction_5);

		// crystals1_improved_refraction_6
		const crystals1_improved_refraction_6 = scene.add.image(2, 139, "Crystals1-improved refraction_6", 0);
		this.add(crystals1_improved_refraction_6);

		// crystals1_improved_refraction_7
		const crystals1_improved_refraction_7 = scene.add.image(24, 139, "Crystals1-improved refraction_11", 0);
		this.add(crystals1_improved_refraction_7);

		// crystals1_improved_refraction_8
		const crystals1_improved_refraction_8 = scene.add.image(48, 96, "Crystals1-improved refraction_11", 0);
		this.add(crystals1_improved_refraction_8);

		// crystals1_improved_refraction_9
		const crystals1_improved_refraction_9 = scene.add.image(57, 119, "Crystals1-improved refraction_11", 0);
		this.add(crystals1_improved_refraction_9);

		// crystals1_improved_refraction_10
		const crystals1_improved_refraction_10 = scene.add.image(41, 143, "Crystals1-improved refraction_11", 0);
		this.add(crystals1_improved_refraction_10);

		// crystals1_improved_refraction_11
		const crystals1_improved_refraction_11 = scene.add.image(64, 151, "Crystals1-improved refraction_11", 0);
		this.add(crystals1_improved_refraction_11);

		// crystals1_improved_refraction_12
		const crystals1_improved_refraction_12 = scene.add.image(-15, 154, "Crystals1-improved refraction_11", 0);
		this.add(crystals1_improved_refraction_12);

		// crystals1_improved_refraction_13
		const crystals1_improved_refraction_13 = scene.add.image(-31, 176, "Crystals1-improved refraction_11", 0);
		this.add(crystals1_improved_refraction_13);

		// crystals1_improved_refraction_14
		const crystals1_improved_refraction_14 = scene.add.image(-9, 192, "Crystals1-improved refraction_11", 0);
		this.add(crystals1_improved_refraction_14);

		// crystals1_improved_refraction_15
		const crystals1_improved_refraction_15 = scene.add.image(18, 200, "Crystals1-improved refraction_11", 0);
		this.add(crystals1_improved_refraction_15);

		// crystals1_improved_refraction_16
		const crystals1_improved_refraction_16 = scene.add.image(39, 196, "Crystals1-improved refraction_11", 0);
		this.add(crystals1_improved_refraction_16);

		// crystals1_improved_refraction_17
		const crystals1_improved_refraction_17 = scene.add.image(66, 175, "Crystals1-improved refraction_11", 0);
		this.add(crystals1_improved_refraction_17);

		// crystals1_improved_refraction_18
		const crystals1_improved_refraction_18 = scene.add.image(2, 169, "Crystals1-improved refraction_6", 0);
		this.add(crystals1_improved_refraction_18);

		// crystals1_improved_refraction_19
		const crystals1_improved_refraction_19 = scene.add.image(35, 167, "Crystals1-improved refraction_8", 0);
		this.add(crystals1_improved_refraction_19);

		// crystals1_improved_refraction_20
		const crystals1_improved_refraction_20 = scene.add.image(14, 60, "Crystals1-improved refraction_11", 0);
		this.add(crystals1_improved_refraction_20);

		// crystals1_improved_refraction_21
		const crystals1_improved_refraction_21 = scene.add.image(-13, 50, "Crystals1-improved refraction_11", 0);
		this.add(crystals1_improved_refraction_21);

		// crystals1_improved_refraction_22
		const crystals1_improved_refraction_22 = scene.add.image(33, 54, "Crystals1-improved refraction_6", 0);
		this.add(crystals1_improved_refraction_22);

		this.rock_pillars_coming_from_darkness_bg_00 = rock_pillars_coming_from_darkness_bg_00;
		this.statues_far_from_platforms_bg_40 = statues_far_from_platforms_bg_40;
		this.crystals1_improved_refraction_80 = crystals1_improved_refraction_80;
		this.crystals1_improved_refraction_110 = crystals1_improved_refraction_110;
		this.crystals1_improved_refraction_60 = crystals1_improved_refraction_60;
		this.crystals1_improved_refraction = crystals1_improved_refraction;
		this.crystals1_improved_refraction_1 = crystals1_improved_refraction_1;
		this.crystals1_improved_refraction_2 = crystals1_improved_refraction_2;
		this.crystals1_improved_refraction_3 = crystals1_improved_refraction_3;
		this.crystals1_improved_refraction_4 = crystals1_improved_refraction_4;
		this.crystals1_improved_refraction_5 = crystals1_improved_refraction_5;
		this.crystals1_improved_refraction_6 = crystals1_improved_refraction_6;
		this.crystals1_improved_refraction_7 = crystals1_improved_refraction_7;
		this.crystals1_improved_refraction_8 = crystals1_improved_refraction_8;
		this.crystals1_improved_refraction_9 = crystals1_improved_refraction_9;
		this.crystals1_improved_refraction_10 = crystals1_improved_refraction_10;
		this.crystals1_improved_refraction_11 = crystals1_improved_refraction_11;
		this.crystals1_improved_refraction_12 = crystals1_improved_refraction_12;
		this.crystals1_improved_refraction_13 = crystals1_improved_refraction_13;
		this.crystals1_improved_refraction_14 = crystals1_improved_refraction_14;
		this.crystals1_improved_refraction_15 = crystals1_improved_refraction_15;
		this.crystals1_improved_refraction_16 = crystals1_improved_refraction_16;
		this.crystals1_improved_refraction_17 = crystals1_improved_refraction_17;
		this.crystals1_improved_refraction_18 = crystals1_improved_refraction_18;
		this.crystals1_improved_refraction_19 = crystals1_improved_refraction_19;
		this.crystals1_improved_refraction_20 = crystals1_improved_refraction_20;
		this.crystals1_improved_refraction_21 = crystals1_improved_refraction_21;
		this.crystals1_improved_refraction_22 = crystals1_improved_refraction_22;

		/* START-USER-CTR-CODE */
        // Setup physics for collision
        scene.physics.add.existing(this, false);

        this.body = this.body || {};
        this.body.allowGravity = false;
        this.body.setSize(120, 75); 
        this.body.setOffset(-45, 135);
        this.body.moves = false;
        this.body.immovable = true;

        this.isStatueInvisible = false;
        this.isPlayerInvisible = false;

        this.statueTop = this.y - 95;
        this.statueBottom = this.y + 200;

        // Set up update event
        this.updateListener = () => this.checkPlayerPosition();
        scene.events.on('update', this.updateListener);
		/* END-USER-CTR-CODE */
	}

	/** @type {Phaser.GameObjects.Image} */
	rock_pillars_coming_from_darkness_bg_00;
	/** @type {Phaser.GameObjects.Image} */
	statues_far_from_platforms_bg_40;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_80;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_110;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_60;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_1;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_2;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_3;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_4;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_5;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_6;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_7;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_8;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_9;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_10;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_11;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_12;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_13;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_14;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_15;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_16;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_17;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_18;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_19;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_20;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_21;
	/** @type {Phaser.GameObjects.Image} */
	crystals1_improved_refraction_22;

	/* START-USER-CODE */

    setupCollision(player) {
        if (!this.scene || !player) return;

        this.scene.physics.add.collider(player, this, null, null, this);
        this.player = player;
    }

    checkPlayerPosition() {
        if (!this.player || !this.scene) return;

        const playerNearStatueX = Math.abs(this.player.x + 10 - this.x - 25) < 55;

        const playerBehindStatue = this.player.y > this.statueTop && 
                                  this.player.y < this.statueBottom && 
                                  playerNearStatueX;

        if (playerBehindStatue) {
            if (!this.isStatueInvisible) {
                this.scene.tweens.add({
                    targets: this,
                    alpha: 0.4,
                    duration: 200,
                    ease: 'Power1',
                    onComplete: () => {
                        this.isStatueInvisible = true;
                    }
                });
            }


            if (!this.isPlayerInvisible) {
                this.scene.tweens.add({
                    targets: this.player,
                    alpha: 0.3,
                    duration: 200,
                    ease: 'Power1',
                    onComplete: () => {
                        this.isPlayerInvisible = true;
                    }
                });
            }
        } else {

            if (this.isStatueInvisible) {
                this.scene.tweens.add({
                    targets: this,
                    alpha: 1,
                    duration: 200,
                    ease: 'Power1',
                    onComplete: () => {
                        this.isStatueInvisible = false;
                    }
                });
            }


            if (this.isPlayerInvisible) {
                this.scene.tweens.add({
                    targets: this.player,
                    alpha: 1,
                    duration: 200,
                    ease: 'Power1',
                    onComplete: () => {
                        this.isPlayerInvisible = false;
                    }
                });
            }
        }
    }


    destroy() {
        if (this.scene) {
            this.scene.events.off('update', this.updateListener);
        }
        super.destroy();
    }
	/* END-USER-CODE */
}

/* END OF COMPILED CODE */

// You can write more code here